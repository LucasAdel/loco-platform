#!/bin/bash
# Pre-push hook for Rust projects

set -e

echo "ğŸš€ Running pre-push checks..."

# Run all tests
echo "ğŸ§ª Running tests..."
if ! cargo test --all; then
    echo "âŒ Tests failed"
    exit 1
fi

# Check for security vulnerabilities
echo "ğŸ”’ Running security audit..."
if command -v cargo-audit >/dev/null 2>&1; then
    if ! cargo audit; then
        echo "âš ï¸  Security vulnerabilities found (non-blocking)"
        # Don't exit on audit failures, just warn
    fi
else
    echo "â„¹ï¸  cargo-audit not installed, skipping security check"
    echo "   Install with: cargo install cargo-audit"
fi

# Build check for all targets
echo "ğŸ—ï¸  Checking builds..."
if ! cargo build --all; then
    echo "âŒ Build failed"
    exit 1
fi

# Documentation check
echo "ğŸ“š Checking documentation..."
if ! cargo doc --no-deps --all; then
    echo "âŒ Documentation build failed"
    exit 1
fi

echo "âœ… All pre-push checks passed!"